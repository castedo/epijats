{% macro orcid_url(orcid) -%}
{% if not orcid.startswith("http") %}https://orcid.org/{% endif %}{{orcid | escape}}
{%- endmacro %}

{% set swh_archive_url = "https://archive.softwareheritage.org/" %}

{% macro link_fonts() %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono&family=Fira+Sans&family=Fira+Sans+Condensed&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono&family=Fira+Sans+Condensed&family=Fira+Sans:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
{% endmacro %}


{% macro contributors_list(contributors, show_email=True) %}
<dl class="contributors">
  {% for contributor in contributors %}
    <dt>
      {{ (contributor['given-names'] ~ ' ' ~ contributor.surname) | escape }}
      {% if contributor.orcid %}
        <a class="orcid" href="{{ orcid_url(contributor.orcid) }}"><i class="orcid-icon"></i></a>
      {%- endif -%}
    </dt>
    {% if contributor.email and show_email %}
      <dd><a href="mailto:{{ contributor.email[0] | escape }}">{{ contributor.email | join(', ') | escape }}</a></dd>
    {% endif %}
  {% endfor %}
</dl>
{% endmacro %}


{% macro common_css() %}
  <style>
    article a, article a:visited {
      color: var(--main-color);
      text-decoration: inherit;
    }
    article img {
      display: block;
      max-height: 6in;
      max-width: 90%;
      margin: 1em auto;
    }
    article p img {
      display: inline;
      margin: 0;
    }
    article ol, article ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    article li > ol, article li > ul {
      margin-top: 0;
    }
    article code {
      font-family: var(--eprint-font-mono);
      white-space: pre-wrap;
      hyphens: none;
      break-inside: avoid;
    }

    article figure {
      break-inside: avoid;
      margin: 2em 0 2em -20%;
      width: 120%;
    }
    article figcaption {
      font-size: 0.8em;
      font-style: italic;
      margin: auto;
      width: 80%;
    }

    article blockquote {
      border-color: var(--main-color);
      border-left: 2px solid;
      font-style: italic;
      margin: 1.5em;
      padding: 0.5em 1em;
    }
    article blockquote > :first-child {
      margin-top: 0;
    }
    article blockquote > :last-child {
      margin-bottom: 0;
    }

    article pre {
      margin: 1em 0;
      overflow: auto;
      break-inside: avoid;
      hyphens: none;
    }
    article pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }

    article table {
      border-collapse: collapse;
      font-size: 0.8em;
      overflow-x: auto;
    }
    article tr {
      break-inside: avoid;
    }
    article td, article th {
      border: 0.005in solid;
      border-color: var(--light-text-color);
      padding: 0.5em;
      vertical-align: top;
    }

    article sub, article sup {
      line-height: 0;
    }

    article hr {
      border: 0;
      border-color: var(--text-color);
      border-top: 0.005in solid;
    }
  </style>
{% endmacro %}


{% macro pandoc_class_css() %}
  <style>
    /* bibliographic references */

    article div.csl-entry {
      clear: both;
      break-inside: avoid;
    }
    article .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    article div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    article div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    article div.csl-indent {
      margin-left: 2em;
    }
  </style>
{% endmacro %}

{% macro var_base_font_css() %}
  <style>
    :root {
      /* calculated variables to use */

      --min-body-width: calc(var(--min-body-width-rem) * 1rem);

      --base-font-size: max(
        var(--min-font-size-rem) * 1rem,
        min(var(--var-font-size), var(--max-font-size))
      );


      /* input variables for calculated variables */

      --max-font-size: 1.25rem;
      --min-font-size-rem: 0.875;
      --min-body-width-rem: 22.5;     /* 360px when rem is 16px */
      --unit-font-view-width-rem: 66; /* viewport width when base font reach 1rem */


      /* bunch of calculation variables for --base-font-size */

      --var-font-ratio: calc(
        (1 - var(--min-font-size-rem)) /
        (var(--unit-font-view-width-rem) - var(--min-body-width-rem))
      );
      --var-font-const: calc(
        var(--min-font-size-rem) - var(--var-font-ratio) * var(--min-body-width-rem)
      );
      --var-font-size: calc(
        var(--var-font-const) * 1rem + var(--var-font-ratio) * 100vw 
      );
    }
  </style>
{% endmacro %}
